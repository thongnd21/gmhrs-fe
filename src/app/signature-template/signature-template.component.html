<nz-spin [nzSpinning]="isSpinning" [nzSize]="'large'">
    <div style="margin: auto;">
        <mat-tab-group mat-align-tabs="start">
            <mat-tab label="Default Signature Template" style="display: list-item;">
                <div style="display: inline-block; padding: 0.5cm; z-index: 2; background-color: white; width: 100%;">
                    <ng-container style="margin-left: 5mm;">
                        <button nz-button nz-dropdown style="font-size: large;" [nzPlacement]="topCenterPosition"
                            [nzDropdownMenu]="menu">
                            Add dynamic content</button>
                        <nz-dropdown-menu #menu="nzDropdownMenu">
                            <ul nz-menu>
                                <li (click)="addContent('phone')" nz-menu-item>Add employee phone number</li>
                                <li (click)="addContent('email')" nz-menu-item>Add employee email address</li>
                                <li (click)="addContent('name')" nz-menu-item>Add employee fullname</li>
                            </ul>
                        </nz-dropdown-menu>
                    </ng-container>
                    <button nz-button style="background-color: coral; border: coral; margin-left: 5mm;"
                        [nzType]="'primary'" (click)="showModal()"><span>Insert Image</span></button>
                    <nz-modal style="display: inline-flex;" [(nzVisible)]="insertImgModel" nzTitle="Insert Image"
                        (nzOnCancel)="handleCancelModel()" (nzOnOk)="insertImghandleOkModel()">
                        <input nz-input placeholder="Paste your image link" [(ngModel)]="imageLink" />
                        <input type="text" disabled nz-input placeholder="Width"
                            style="width: 25%; border-left: 1px; pointer-events: none; background-color: white;" />
                        <nz-input-number style="width: 25%;" [(ngModel)]="imgWidth" [nzMin]="1" [nzMax]="400"
                            [nzStep]="1">
                        </nz-input-number>
                        <input type="text" disabled nz-input placeholder="Heigh"
                            style="width: 25%; border-left: 1px; pointer-events: none; background-color: white;" />
                        <nz-input-number style="width: 25%;" [(ngModel)]="imgHeigh" [nzMin]="1" [nzMax]="400"
                            [nzStep]="1">
                        </nz-input-number>
                        <img [ngStyle]="{'width':imgWidth + 'px'}" [ngStyle]="{'height':imgHeigh + 'px'}"
                            style="width: 100%; height: 100%;" [src]="imageLink" alt="" />
                    </nz-modal>
                    <button nz-button style="background-color: darkblue; border: darkblue; margin-left: 5mm;"
                        (click)="loadReview()" nzType="primary">Load review</button>
                    <nz-badge [nzCount]="listRulesCheckErr.length">
                        <a class="head-example" (click)="showRulesCheckModel()">
                            <i nz-icon style="font-size: x-large; margin-left: 5mm;" nzType="notification"></i>
                        </a>
                    </nz-badge>
                    <button nz-button style="float: right;" (click)="getAllSignature()"
                        [nzLoading]="isGetAllSignatureLoading" nzType="primary">All signature template</button>
                    <nz-modal style="display: inline-block;" [(nzVisible)]="showCheckErrModel"
                        nzTitle="Signature template rules check" nzCancelText="Close" (nzOnCancel)="handleCloseModel()"
                        (nzOnOk)="handleCloseModel()">
                        <nz-alert nzType="warning" *ngFor="let err of listRulesCheckErr;" nzMessage="{{err}}"
                            nzShowIcon>
                        </nz-alert>
                    </nz-modal>
                    <nz-modal style="display: inline-block; width: 70%;" [(nzVisible)]="showListSignatureTemplate"
                        nzTitle="Signature templates" nzCancelText="Close" (nzOnCancel)="handleCloseModel()"
                        (nzOnOk)="handleCloseModel()">
                        <nz-table #columnTable [nzData]="listSignatureTemplate" [nzScroll]="{ x: '200px' }">
                            <thead>
                                <tr>
                                    <th style="width: 30%;">Name</th>
                                    <th style="width: 30%;">Default</th>
                                    <th style="width: 20%;">Load</th>
                                    <th style="width: 20%;">Delete</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let data of listSignatureTemplate">
                                    <td style="font-size: large;">{{ data.name }}</td>
                                    <td><i *ngIf="data.is_primary === 1" nz-icon style="font-size: x-large;"
                                            [nzType]="'check-circle'" [nzTheme]="'twotone'"
                                            [nzTwotoneColor]="'#52c41a'"></i></td>
                                    <td>
                                        <button nz-button style="float: right;"
                                            (click)="getSignatureTemplateByName(data.name)"
                                            [nzLoading]="isGetAllSignatureLoading" nzType="primary">Load</button>
                                    </td>
                                    <td>

                                        <button nz-button nzDanger style="float: right;"
                                            (click)="showConfirmDeleteSiganture(data.name)"
                                            [nzLoading]="isDeleteTemplateLoading" nzType="primary">Delete</button>

                                    </td>
                                </tr>
                            </tbody>
                        </nz-table>
                    </nz-modal>
                </div>
                <nz-input-group style="margin-top: 1cm;" nzAddOnBefore="Signature name">
                    <input type="text" placeholder="Signature name" nz-input [(ngModel)]="signatureName" />
                </nz-input-group>
                <div style="margin-top: 1mm;">
                    <angular-editor (focus)="select($event)" style="outline-color: white;" id="editor1"
                        [(ngModel)]="htmlContent" [config]="editorConfig">
                    </angular-editor>
                </div>


                <!-- <p>
                    {{htmlContent}}
                </p> -->
                <br />
                <div>
                    <angular-editor style="background-color: white;" id="editor2" [(ngModel)]="htmlContentReview"
                        [config]="editorReviewConfig">
                    </angular-editor>
                </div>
                <br />
                <br />
                <div>
                    <p>
                        <button nz-button style="margin-right: 1cm;" [nzLoading]="isSaveTemplateLoading"
                            (click)="showConfirmSaveSignature()" nzType="primary">Save</button>
                        <button nz-button style="margin-right: 1cm;" (click)="showConfirmUpdateAllSignature()"
                            [nzLoading]="isUpdatedTemplateLoading" nzType="primary">Synchronize now</button>
                        <button nz-button style="margin-right: 1cm;" (click)="setPrimaryTemplate()"
                            [disabled]="isSetPrimaryDisable" [nzLoading]="isSetPrimaryTemplateLoading"
                            nzType="primary">Set
                            primary</button>
                    </p>
                </div>
            </mat-tab>
            <mat-tab label="Signature Template Rules">
                <br />
                <p>
                    <button nz-button (click)="addRow()" nzType="primary">Add row</button>
                </p>
                <br />
                <nz-input-group nzCompact>
                    <input type="text" disabled readonly nz-input placeholder="Input range of signature length"
                        style="width: 23%; pointer-events: none; background-color: white" />
                    <input type="text" disabled nz-input placeholder="Minimum length"
                        style="width: 150px; border-left: 0px; pointer-events: none; background-color: rgb(255, 255, 255);" />
                    <nz-input-number [(ngModel)]="rules.lengthRule.minLength" [nzMin]="1" [nzMax]="10000"
                        style="width:100px; text-align: center;">
                    </nz-input-number>
                    <input type="text" disabled nz-input placeholder="Maximum length"
                        style="width: 150px; border-left: 0px; pointer-events: none; background-color: rgb(255, 255, 255);" />
                    <nz-input-number [nzMin]="1" [nzMax]="10000" [(ngModel)]="rules.lengthRule.maxLength"
                        style="width: 100px; text-align: center; border-left: 0px;">
                    </nz-input-number>
                </nz-input-group>
                <br />
                <nz-table #editRowTable nzBordered [nzData]="listOfRules">
                    <thead>
                        <tr>
                            <th nzWidth="15%">Rule</th>
                            <th nzWidth="67%">Content</th>
                            <th nzWidth="8%">Delete</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let data of editRowTable.data" class="editable-row">
                            <td>
                                <nz-select [(ngModel)]="data.action" nzShowSearch
                                    nzPlaceHolder="Select action for this text">
                                    <nz-option nzValue="true" nzLabel="Contain this text"></nz-option>
                                    <nz-option nzValue="false" nzLabel="Not contain this text"></nz-option>
                                </nz-select>
                            </td>
                            <td>
                                <textarea (select)="select($event)" nzAutosize placeholder="Input content" type="text"
                                    nz-input (click)="startEdit(data.id); select($event)" [(ngModel)]="data.content"
                                    (blur)="stopEdit()"></textarea>
                            </td>
                            <td>
                                <a style="color: red;" (click)="deleteRow(data.id)">Delete</a>
                            </td>
                        </tr>
                    </tbody>
                </nz-table>
                <nz-modal style="display: inline-block;" [(nzVisible)]="showListWrongSignature"
                    nzTitle="List employee wrong signature" nzCancelText="Close" nzOkText="Send mail remind employees"
                    (nzOnCancel)="handleCloseModel()" (nzOnOk)="sendMailRemind()">
                    <nz-collapse nzAccordion>
                        <nz-collapse-panel *ngFor="let element of listWrongSignature" [nzHeader]="element.email">
                            <p>
                                <nz-alert nzType="warning" *ngFor="let mes of element.message" nzMessage="{{mes}}"
                                    style="font-size: medium;" nzShowIcon>
                                </nz-alert>
                            </p>
                        </nz-collapse-panel>
                    </nz-collapse>
                    <!-- <ul *ngFor="let element of listWrongSignature">Email: {{element.email}}
                        <li *ngFor="let mes of element.message">{{mes}}</li>
                    </ul> -->
                </nz-modal>
                <button nz-tooltip nzTooltipTitle="prompt text" [disabled]="isSaveRuleDisable" nz-button
                    style="margin-right: 1cm;" (click)="showConfirmSaveSignatureRules()"
                    [nzLoading]="isSaveRulesLoading" nzType="primary">Save</button>
                <button nz-tooltip [disabled]="isSaveRuleDisable" nz-button style="margin-right: 1cm;"
                    (click)="showConfirmNotifySignatureRules()" [nzLoading]="isSendNotifyRulesLoading" nzType="primary">
                    Notify to all emloyees</button>
                <button nz-tooltip [disabled]="isSaveRuleDisable" nz-button style="margin-right: 1cm;"
                    (click)="getListWrongSignature()" [nzLoading]="isShowListWrongSignatureLoading"
                    nzType="primary">Show
                    list wrong signature
                    employee</button>
            </mat-tab>
        </mat-tab-group>
    </div>
</nz-spin>